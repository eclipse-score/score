
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Testing Guidelines &#8212; S-CORE  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/score.css?v=6e51530f" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/score_needs.css?v=e97392eb" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/score_design.css?v=d9fd870c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-data-viewer/jsonview.bundle.css?v=f6ef2277" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-needs/libs/html/datatables.min.css?v=4b4fd840" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-needs/common_css/need_toggle.css?v=5c6620df" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-needs/common_css/needstable.css?v=5e1b6797" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-needs/common_css/need_core.css?v=f5b60a78" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-needs/common_css/need_links.css?v=2150a916" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-needs/common_css/need_style.css?v=92936fa5" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-needs/modern.css?v=803738c0" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../_static/documentation_options.js?v=7f41d439"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../../_static/sphinx-data-viewer/jsonview.bundle.js?v=18cd53c5"></script>
    <script src="../../_static/sphinx-data-viewer/jsonview_loader.js?v=f7ff7e7d"></script>
    <script src="../../_static/sphinx-needs/libs/html/datatables.min.js?v=8a4aee21"></script>
    <script src="../../_static/sphinx-needs/libs/html/datatables_loader.js?v=a2cae175"></script>
    <script src="../../_static/sphinx-needs/libs/html/sphinx_needs_collapse.js?v=dca66431"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'contribute/development/testing_guidelines';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://eclipse-score.github.io/score/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="CI" href="../ci/index.html" />
    <link rel="prev" title="Writing Python Code" href="python/coding_guidelines.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.1" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Eclipse S-CORE</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../handbook/index.html">
    Handbook
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../features/index.html">
    Features
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../requirements/index.html">
    Requirements
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../modules/index.html">
    Modules
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Contribute
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../score_releases/index.html">
    Releases
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../score_tools/index.html">
    Tools
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../platform_management_plan/index.html">
    PMP
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://projects.eclipse.org/projects/automotive.score">
    Eclipse
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../design_decisions/index.html">
    Decision Records
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../introduction/index.html">
    Eclipse S-CORE (Eclipse Safe Open Vehicle Core)
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/eclipse-score" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../handbook/index.html">
    Handbook
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../features/index.html">
    Features
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../requirements/index.html">
    Requirements
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../modules/index.html">
    Modules
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Contribute
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../score_releases/index.html">
    Releases
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../score_tools/index.html">
    Tools
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../platform_management_plan/index.html">
    PMP
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://projects.eclipse.org/projects/automotive.score">
    Eclipse
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../design_decisions/index.html">
    Decision Records
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../introduction/index.html">
    Eclipse S-CORE (Eclipse Safe Open Vehicle Core)
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/eclipse-score" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../contribution_request/index.html">How to Contribute?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general/index.html">General</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/index.html">Documentation</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Development</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="development_environment.html">Setting Up the Development Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="traceability_tooling.html">Traceability Tooling</a></li>
<li class="toctree-l2"><a class="reference internal" href="api_guideline.html">Designing API</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpp/index.html">C++</a></li>
<li class="toctree-l2"><a class="reference internal" href="rust/index.html">Rust</a></li>
<li class="toctree-l2"><a class="reference internal" href="python/index.html">Python</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Testing Guidelines</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../ci/index.html">CI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fork/index.html">Enterprise Forking Guide for S-CORE Repositories</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Contribute</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Development</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Testing Guidelines</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="testing-guidelines">
<h1>Testing Guidelines<a class="headerlink" href="#testing-guidelines" title="Link to this heading">#</a></h1>
<div class="need_container docutils container" id="SNCB-d26fded3">
<div class="pst-scrollable-table-container"><table class="need needs_grid_complex needs_layout_score needs_style_none needs_type_document table" id="doc__testing_guidelines">
<tbody>
<tr class="head row-odd"><td class="head_left" colspan="2"><div class="needs_head_left line-block">
<div class="line"><span><span class="needs_title"><span class="needs_data">Testing Guidelines</span></span></span></div>
</div>
</td>
<td class="head_center" colspan="2"><div class="needs_head line-block">
<div class="line"><span><span class="needs_status"><span class="needs_label">status: </span><span class="needs_data">valid</span></span></span></div>
<div class="line"><span><span class="needs_security"><span class="needs_label">security: </span><span class="needs_data">YES</span></span></span></div>
<div class="line"><span><span class="needs_safety"><span class="needs_label">safety: </span><span class="needs_data">ASIL_B</span></span></span></div>
</div>
</td>
<td class="head_right" colspan="2"><div class="needs_head_right line-block">
<div class="line"><span><span class="needs needs_collapse" id="target__show__meta"><span class="needs collapsed"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-down-circle"><circle cx="12" cy="12" r="10"></circle><polyline points="8 12 12 16 16 12"></polyline><line x1="12" y1="8" x2="12" y2="16"></line></svg></span><span class="needs visible collapse_is_hidden"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right-circle"><circle cx="12" cy="12" r="10"></circle><polyline points="12 16 16 12 12 8"></polyline><line x1="8" y1="12" x2="16" y2="12"></line></svg></span></span></span></div>
</div>
</td>
</tr>
<tr class="meta row-even"><td class="meta" colspan="3"><div class="needs_meta_left line-block">
<div class="line"><span><span></span></span></div>
<div class="line"><span><div class="line">realizes: <span class="realizes"><span><a class="external_link reference external" href="https://eclipse-score.github.io/process_description//main/process_areas/implementation/implementation_workproducts.html#wp__sw_development_plan">wp__sw_development_plan</a></span></span></div>
</span></div>
</div>
</td>
<td class="meta" colspan="3"></td>
</tr>
<tr class="content row-odd"><td class="content" colspan="6"></td>
</tr>
<tr class="footer row-even"><td class="footer_left" colspan="2"><div class="needs_footer_left line-block">
<div class="line"><span><span class="needs-id"><a class="reference internal" href="#doc__testing_guidelines" title="doc__testing_guidelines">doc__testing_guidelines</a></span></span></div>
</div>
</td>
<td class="footer" colspan="2"><div class="needs_footer line-block">
<div class="line"><span><span class="needs_type_name"><span class="needs_data">Generic Document</span></span></span></div>
</div>
</td>
<td class="footer_right" colspan="2"></td>
</tr>
</tbody>
</table>
</div>
</div>
<p>These guidelines are based on discussions within the score com team. They’re not set in stone and can be changed in the future.
Feel free to submit a PR if you disagree with something or want to add something.
These rules can also be deviated from depending on the specific case. It’s impossible to come up with guidelines that are suitable
in every single situation so use these as a starting point and if following the guidelines would make the tests less readable,
less functional, more complex etc then you can deviate. However, if you want to deviate, only do so because there’s a good reason.</p>
<section id="test-naming">
<h2>Test Naming<a class="headerlink" href="#test-naming" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">TEST(TestSuiteName,</span> <span class="pre">TestName)</span></code></p>
<p>We don’t propose any strict guidelines for <code class="docutils literal notranslate"><span class="pre">TestSuiteName</span></code> or <code class="docutils literal notranslate"><span class="pre">TestName</span></code> except that the names:</p>
<ul class="simple">
<li><p>should be descriptive</p></li>
<li><p>should use PascalCase style.</p></li>
<li><p>a <code class="docutils literal notranslate"><span class="pre">TestSuiteName</span></code> that does not use a fixture should have the suffix <code class="docutils literal notranslate"><span class="pre">Test</span></code>.</p></li>
<li><p>a <code class="docutils literal notranslate"><span class="pre">TestSuiteName</span></code> that does use a fixture should have the suffix <code class="docutils literal notranslate"><span class="pre">Fixture</span></code>.</p></li>
</ul>
<p>It should be clear from the name of a test what exactly it’s testing. Conceptually following
“Given, when, then” in your naming may help to come up with a good name.</p>
<p>E.g. <code class="docutils literal notranslate"><span class="pre">TEST(RuntimeWithInvalidTracingRuntimeTest,</span> <span class="pre">WhenCallingTraceThenAnErrorIsReturned)</span></code>
<code class="docutils literal notranslate"><span class="pre">TEST(SkeletonFieldPrepareOfferTest,</span> <span class="pre">WhenCallingPrepareOfferBeforeCallingUpdateThenAnErrorIsReturned)</span></code></p>
<p>You can also use the <code class="docutils literal notranslate"><span class="pre">TestSuiteName</span></code> to group together tests that are testing the same functions / behaviours.
Note: if using descriptive <code class="docutils literal notranslate"><span class="pre">TestSuiteName</span></code>s, then you can reduce repetition in the <code class="docutils literal notranslate"><span class="pre">TestName</span></code>.</p>
<p>E.g.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TEST(SkeletonEventTest,</span> <span class="pre">WhenCallingSendThenSendWillBeCalledOnTheSkeletonEventBinding)</span></code> can be shortened to <code class="docutils literal notranslate"><span class="pre">TEST(SkeletonEventSendTest,</span> <span class="pre">SendWillBeCalledOnTheSkeletonEventBinding)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TEST(ProxyEventFixture,</span> <span class="pre">CallingGetNewSamplesCallsReceiverForEachSample)</span></code> can be shortened to <code class="docutils literal notranslate"><span class="pre">TEST(ProxyEventGetNewSamplesFixture,</span> <span class="pre">CallsReceiverForEachSample)</span></code></p></li>
</ul>
<p>The only strict guideline is that any tests which contain <code class="docutils literal notranslate"><span class="pre">EXPECT_DEATH</span></code> should always have <code class="docutils literal notranslate"><span class="pre">DeathTest</span></code> at the end of <code class="docutils literal notranslate"><span class="pre">TestSuiteName</span></code>.
(See <a class="reference external" href="https://github.com/google/googletest/blob/main/docs/advanced.md#death-tests-and-threads">Death Tests and Threads</a>).
More information about death tests in the <a class="reference internal" href="#death-tests"><span class="std std-ref">Death Tests</span></a> section.</p>
</section>
<section id="test-content">
<h2>Test Content<a class="headerlink" href="#test-content" title="Link to this heading">#</a></h2>
<section id="given-when-expecting-then">
<h3>Given, When, (Expecting / Then)<a class="headerlink" href="#given-when-expecting-then" title="Link to this heading">#</a></h3>
<p>You can read about the “Given, when, then” test structure (this gives a good and simple summary:
<a class="reference external" href="https://martinfowler.com/bliki/GivenWhenThen.html">GivenWhenThen</a>). We add in an additional
section “Expecting”, which can be optionally added to add expectations on mocked function calls.</p>
<section id="given">
<h4>Given<a class="headerlink" href="#given" title="Link to this heading">#</a></h4>
<p>The “Given” section of the test should contain the setup code required to get the environment into a state
that is ready to run the actual code to be tested in the “When” section.
Unless this code is very minimal (e.g. one or two lines), this should be added to a test fixture.</p>
<p>This section also includes any default behaviour required on mocks. (<code class="docutils literal notranslate"><span class="pre">ON_CALL</span></code>s)</p>
</section>
<section id="expecting">
<h4>Expecting<a class="headerlink" href="#expecting" title="Link to this heading">#</a></h4>
<p>This is where you check that a certain mock call was called as a result of the behaviour in the “When” section,
when the mock call itself is what you’re testing for (See <a class="reference internal" href="#expect-call-vs-on-call"><span class="std std-ref">EXPECT_CALL vs ON_CALL</span></a> for further explanation).
This should be an <code class="docutils literal notranslate"><span class="pre">EXPECT_CALL</span></code>.</p>
<p>Sometimes you might have an “Expecting” section and a “Then” section. This can happen when the return value
tested in the “Then” section is completely related to the expectation in the “Expecting” section.
E.g. if the function under test returns the value returned by the mock function, or it forwards
an error from the mock function etc. If they’re not clearly related, then they should not both be asserted
in the same test. E.g. if the mock function is simply a side effect and doesn’t affect the return value of
the function under test. This would become evident because there would then be multiple tests with different
expected behaviour specified on the mock function with the exact same return value from the function under test.</p>
<p>If there are multiple mocked functions whose behaviour is specified in a test, then we only add multiple
<code class="docutils literal notranslate"><span class="pre">EXPECT_CALL</span></code>s if all the functions are dependent on something else set in the “Given” section, rather
than simply being dependent on each other. E.g. if some state is true, then 2 mock functions will be
called: in this case, you can have 2 <code class="docutils literal notranslate"><span class="pre">EXPECT_CALL</span></code>s in a single test. However, if one function is
dependent on the other function, then it’s better to have one mock expectation specified in the “Given”
section and the other in the “Expecting” section. E.g. “Given FunctionA returns x, Expecting that FunctionB returns y”.</p>
</section>
<section id="when">
<h4>When<a class="headerlink" href="#when" title="Link to this heading">#</a></h4>
<p>This is the behaviour that you want to test.</p>
</section>
<section id="then">
<h4>Then<a class="headerlink" href="#then" title="Link to this heading">#</a></h4>
<p>This is where you check that the behaviour you’re testing performed as expected. E.g. checking the return
value of the function called in the “When” section, checking some side effect etc.</p>
</section>
<section id="examples">
<h4>Examples<a class="headerlink" href="#examples" title="Link to this heading">#</a></h4>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Given, When, Then</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">MyFooTest</span><span class="p">,</span><span class="w"> </span><span class="n">CallingFooReturnsSuccess</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Given some setup code (the test setup should add any required default actions)</span>
<span class="w">    </span><span class="n">MySetup</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// When calling foo</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">foo_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Then we get a valid result</span>
<span class="w">    </span><span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="n">foo_result</span><span class="p">.</span><span class="n">has_value</span><span class="p">());</span>
<span class="p">}</span>

<span class="c1">// Given, Expecting, When</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">MyFooTest</span><span class="p">,</span><span class="w"> </span><span class="n">CallingFooCallsXOnY</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Given some setup code</span>
<span class="w">    </span><span class="n">MySetup</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// Expecting that x is called on y</span>
<span class="w">    </span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">());</span>

<span class="w">    </span><span class="c1">// When calling foo</span>
<span class="w">    </span><span class="n">amp_ignore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Given, Expecting, When, Then</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">MyFooTest</span><span class="p">,</span><span class="w"> </span><span class="n">CallingFooReturnsErrorWhenBindingReturnsError</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Given some setup code</span>
<span class="w">    </span><span class="n">MySetup</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Expecting that when x is called on y it returns an error</span>
<span class="w">    </span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">()).</span><span class="n">WillOnce</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="n">MakeUnexpected</span><span class="p">(</span><span class="n">SomeError</span><span class="p">{}));</span>

<span class="w">    </span><span class="c1">// When calling foo</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">foo_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Then we get an error</span>
<span class="w">    </span><span class="n">EXPECT_FALSE</span><span class="p">(</span><span class="n">foo_result</span><span class="p">.</span><span class="n">has_value</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="what-should-a-test-contain">
<h3>What Should a Test Contain<a class="headerlink" href="#what-should-a-test-contain" title="Link to this heading">#</a></h3>
<p>A unit test should only test one functionality. In general, each test should be testing a single functionality. This may be that:</p>
<ul class="simple">
<li><p>calling a function given some setup will call some other mock function with some specified arguments</p></li>
<li><p>calling a function given some setup will return a particular value</p></li>
<li><p>calling a function given some setup will terminate (More about death tests in the <a class="reference internal" href="#death-tests"><span class="std std-ref">Death Tests</span></a> section)</p></li>
<li><p>a function will return a specific value given what some mock function did / returned.</p></li>
</ul>
<p>Each test should have a single <em>semantic</em> assertion or expectation. If our function calls a mock function which returns
some value and the return value of the function under test is highly dependent on what the mock function did / returned
then we may assert both the behaviour of the mock function and the return value of the function under test in a single test.
E.g. if the function under test simply returns the result of the mock function, if the function under test returns an error
when the mock function returns an error etc. However, if the return value of our function under test does <strong>not</strong> depend
directly on a mock function being called (i.e. the mock function is simply a side effect), then they should be tested in
different tests.</p>
<p>If we want to test that a function returns an error code, then it makes sense to have:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">ASSERT_FALSE</span><span class="p">(</span><span class="n">some_result</span><span class="p">.</span><span class="n">has_value</span><span class="p">());</span>
<span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">some_result</span><span class="p">.</span><span class="n">error</span><span class="p">(),</span><span class="w"> </span><span class="n">SomeErrorCode</span><span class="p">);</span>
</pre></div>
</div>
<p>If a function returns a struct, then ideally we would want to use the comparison operator of the struct to check that
the returned struct is the same as an expected struct. If it doesn’t make sense to add a comparison operator for some
reason and the elements of the struct are related, then we may have multiple expectations. E.g.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">my_dummy_struct</span><span class="p">.</span><span class="n">service_id</span><span class="p">,</span><span class="w"> </span><span class="n">expected_service_id</span><span class="p">);</span>
<span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">my_dummy_struct</span><span class="p">.</span><span class="n">instance_id</span><span class="p">,</span><span class="w"> </span><span class="n">expected_instance_id</span><span class="p">);</span>
</pre></div>
</div>
<p>Another option in this case would be to define a custom matcher within the test file.
See <a class="reference external" href="https://google.github.io/googletest/reference/matchers.html#defining-matchers">Defining Matchers</a> for details.</p>
<p>However, if for example our test function returns a configuration object which contains a lot of unrelated data, then we
may split the test up into multiple tests which each test one part of the returned configuration object.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Sometimes a test will rely on behaviour that was already tested in a previous test. In general, this behaviour should
not be retested. However, sometimes additional asserts may be useful to avoid undefined behaviour in a test. It’s up
to the common sense of the author of the test and the reviewer to decide when additional asserts are needed.</p>
<p>E.g. if a test checks that a certain function returns a valid pointer in certain situations, other tests that make
this same assumption but are not directly testing this behaviour may add an additional assert to check that the pointer
is not a nullptr to avoid undefined behaviour. (Note: in these other tests, the assert should not be in the <code class="docutils literal notranslate"><span class="pre">Then</span></code>
section, but can rather be placed immediately after the function call that returns the pointer so that it’s not
confused with the functionality being tested in that particular test)</p>
</div>
</section>
<section id="expect-call-vs-on-call">
<span id="id1"></span><h3>EXPECT_CALL vs ON_CALL<a class="headerlink" href="#expect-call-vs-on-call" title="Link to this heading">#</a></h3>
<p>Please read: <a class="reference external" href="https://google.github.io/googletest/gmock_cook_book.html#setting-expectations">Setting Expectations</a>.</p>
<p>Generally, <code class="docutils literal notranslate"><span class="pre">ON_CALL</span></code> should be used to set default actions whenever a function on a particular mock is called.
This may be default actions that should occur in every test unless specified otherwise (e.g. every time we call
<code class="docutils literal notranslate"><span class="pre">Runtime::getInstance()</span></code>, then a <code class="docutils literal notranslate"><span class="pre">RuntimeMock</span></code> should be returned). Such expectations should usually be added
to the test fixture as they will be relevant to multiple tests.</p>
<p>If we want to inject some behaviour into a mock function which directly impacts the return value of the function
under test, we should use <code class="docutils literal notranslate"><span class="pre">EXPECT_CALL</span></code> e.g. if we want to test that <code class="docutils literal notranslate"><span class="pre">SkeletonEvent::Send()</span></code> returns an error
if <code class="docutils literal notranslate"><span class="pre">Runtime::getInstance()</span></code> returns a nullptr, then we can add
<code class="docutils literal notranslate"><span class="pre">EXPECT_CALL(runtime_mock_,</span> <span class="pre">getInstance()).WillOnce(Return(nullptr))</span></code> to our test.</p>
<p>We use <code class="docutils literal notranslate"><span class="pre">EXPECT_CALL</span></code> when we want to test that a specific function is called on a mock object as the result of
the behaviour that we’re testing in the “When” section. E.g. if we want to make sure that <code class="docutils literal notranslate"><span class="pre">SkeletonEvent::Send()</span></code>
does not dispatch to the binding given that <code class="docutils literal notranslate"><span class="pre">Runtime::getInstance()</span></code> returns a nullptr, then we can have:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">TEST_F</span><span class="p">(</span><span class="n">SkeletonEventFixture</span><span class="p">,</span><span class="w"> </span><span class="n">CallingSendWillNotDispatchToBindingIfGettingRuntimeReturnsNullptr</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Given that a valid Runtime cannot be returned</span>
<span class="w">    </span><span class="n">ON_CALL</span><span class="p">(</span><span class="n">runtime_mock_</span><span class="p">,</span><span class="w"> </span><span class="n">getInstance</span><span class="p">()).</span><span class="n">WillByDefault</span><span class="p">(</span><span class="n">Return</span><span class="p">(</span><span class="k">nullptr</span><span class="p">));</span>

<span class="w">    </span><span class="c1">// Expecting that Send will NOT be called on the skeleton event binding</span>
<span class="w">    </span><span class="n">EXPECT_CALL</span><span class="p">(</span><span class="n">skeleton_event_binding_mock_</span><span class="p">,</span><span class="w"> </span><span class="n">Send</span><span class="p">()).</span><span class="n">Times</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// When calling Send</span>
<span class="w">    </span><span class="n">amp</span><span class="o">::</span><span class="n">ignore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">skeleton_event_</span><span class="p">.</span><span class="n">Send</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="test-constants">
<h3>Test Constants<a class="headerlink" href="#test-constants" title="Link to this heading">#</a></h3>
<p>Often we require some constants in our tests e.g. which we must pass to the function that we’re testing. If the
specific value of this constant is relevant to the test, then it should be within the test itself. Otherwise,
it should be a global constant or if it’s relevant to the test fixture, it should go there.</p>
<p>E.g.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">TEST_F</span><span class="p">(</span><span class="n">ProxyEventSubscribeFixture</span><span class="p">,</span><span class="w"> </span><span class="n">CallingSubscribeWillChangeSubscriptionStateToSubscribed</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Given a constructed ProxyEvent and an offered service</span>

<span class="w">    </span><span class="c1">// When calling Subscribe</span>
<span class="w">    </span><span class="n">amp</span><span class="o">::</span><span class="n">ignore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">proxy_event_</span><span class="p">.</span><span class="n">Subscribe</span><span class="p">(</span><span class="n">kSomeValidMaxSampleCountThatIDontCareAbout</span><span class="p">);</span><span class="w"> </span><span class="c1">// Constant is global or in the fixture</span>

<span class="w">    </span><span class="c1">// Then the subscription state changes to subscribed</span>
<span class="w">    </span><span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">proxy_event_</span><span class="p">.</span><span class="n">GetSubscriptionState</span><span class="p">(),</span><span class="w"> </span><span class="n">SubscriptionState</span><span class="o">::</span><span class="n">Subscribed</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">ProxyEventSubscribeFixture</span><span class="p">,</span><span class="w"> </span><span class="n">CallingSubscribeWithTooManySamplesWillNotChangeSubscriptionState</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Given a constructed ProxyEvent and an offered service</span>

<span class="w">    </span><span class="c1">// When calling Subscribe with more max_samples than was configured</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">max_samples_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">configured_max_sample_count_</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// Constant is relevant to test so it should be here</span>
<span class="w">    </span><span class="n">amp</span><span class="o">::</span><span class="n">ignore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">proxy_event_</span><span class="p">.</span><span class="n">Subscribe</span><span class="p">(</span><span class="n">max_samples_count</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Then the subscription state is unchanged</span>
<span class="w">    </span><span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">proxy_event_</span><span class="p">.</span><span class="n">GetSubscriptionState</span><span class="p">(),</span><span class="w"> </span><span class="n">SubscriptionState</span><span class="o">::</span><span class="n">NotSubscribed</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If an object is created as a global constant, then it must be ensured that the object does not use globals in its
implementation. There is no guarantee that the global in the implementation of the object will be initialised before
the test global constant which can lead to accessing uninitialised memory.
(See <a class="reference external" href="https://en.cppreference.com/w/cpp/language/siof.html">Static Initialization Order Fiasco</a> for details)</p>
</div>
</section>
</section>
<section id="test-fixtures">
<h2>Test Fixtures<a class="headerlink" href="#test-fixtures" title="Link to this heading">#</a></h2>
<p>We don’t propose any strict guidelines for Test Fixtures. Although we suggest:</p>
<ul class="simple">
<li><p>For consistency all test fixtures should be placed immediately before the first test that uses it. This includes aliases for fixtures.</p></li>
<li><p>Try to keep fixtures small. If they grow too large, then either try to extract some functionality into separate functions or classes and use composition.
Large fixtures may also hint at poor architectural design of the unit under test.</p></li>
<li><p>Avoid inheriting from other fixtures.</p></li>
</ul>
<p>If a test fixture contains some code that must be checked (e.g. the setup code contains an <code class="docutils literal notranslate"><span class="pre">EXPECT</span></code> / <code class="docutils literal notranslate"><span class="pre">ASSERT</span></code>),
then you can also create an empty test which tests that the test setup works as expected. E.g. Assuming the
<code class="docutils literal notranslate"><span class="pre">ProxyEventSubscribeFixture</span></code> will create a <code class="docutils literal notranslate"><span class="pre">ProxyEvent</span></code> and ASSERT that the ProxyEvent was successfully created,
then we can create an empty test:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">TEST_F</span><span class="p">(</span><span class="n">ProxyEventSubscribeFixture</span><span class="p">,</span><span class="w"> </span><span class="n">CanConstructAProxyEvent</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// When constructing a ProxyEvent</span>
<span class="w">    </span><span class="c1">// Then the ProxyEvent can be successfully created without an error</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="test-fixture-builder-pattern">
<h3>Test Fixture Builder Pattern<a class="headerlink" href="#test-fixture-builder-pattern" title="Link to this heading">#</a></h3>
<p>One approach to fixture design is to employ a builder pattern. This allows the test setup code to be done in a concise
and easily readable way, while also making the test setup configurable in each individual test. The idea is to add
functions to the test fixture which return a reference to the fixture itself so that they can be chained together.</p>
<p>You can see an example of the usage in
<a class="reference external" href="https://github.com/eclipse-score/communication/blob/main/score/mw/com/impl/bindings/lola/service_discovery/test/service_discovery_client_test_fixtures.h">service_discovery_client_test_fixtures.h</a>.
The <code class="docutils literal notranslate"><span class="pre">ServiceDiscoveryClientFixture</span></code> contains general setup code which is relevant to all tests in its <code class="docutils literal notranslate"><span class="pre">SetUp()</span></code>
function. It then provides functions such as <code class="docutils literal notranslate"><span class="pre">GivenAServiceDiscoveryClient()</span></code>, <code class="docutils literal notranslate"><span class="pre">WithAnOfferedService(InstanceIdentifier)</span></code>,
<code class="docutils literal notranslate"><span class="pre">WithAnActiveStartFindService()</span></code>. This allows us to minimise the boilerplate code in each test while still allowing
the tests to be readable, easy to understand and easily configurable without copying and pasting boilerplate code.
These functions can also take arguments to allow additional configuration from within the tests themselves.</p>
<p>In general, the unit under test should be created in a function prefixed with <code class="docutils literal notranslate"><span class="pre">Given</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">GivenAServiceDiscoveryClient</span></code>)
rather than in the <code class="docutils literal notranslate"><span class="pre">SetUp()</span></code>. This makes the test more explicit and also allows tests to not call it or to create the
unit under test directly within the test e.g. when testing the destructor of the unit under test, it may have to be created
in the test itself if we need to set an expectation that interacts with a variable defined in the test. Otherwise, the
variable may be destroyed at the end of the test before the unit under test is destroyed in the fixture.</p>
<p>A snippet of the fixture and an example test to illustrate the point:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ServiceDiscoveryClientFixture</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="o">::</span><span class="n">testing</span><span class="o">::</span><span class="n">Test</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">public</span><span class="o">:</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">SetUp</span><span class="p">()</span><span class="w"> </span><span class="k">override</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">ASSERT_TRUE</span><span class="p">(</span><span class="n">inotify_instance_</span><span class="o">-&gt;</span><span class="n">IsValid</span><span class="p">());</span>

<span class="w">        </span><span class="n">ON_CALL</span><span class="p">(</span><span class="n">inotify_instance_mock_</span><span class="p">,</span><span class="w"> </span><span class="n">IsValid</span><span class="p">()).</span><span class="n">WillByDefault</span><span class="p">([</span><span class="k">this</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">inotify_instance_</span><span class="o">-&gt;</span><span class="n">IsValid</span><span class="p">();</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="p">...</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">ServiceDiscoveryClientFixture</span><span class="o">&amp;</span><span class="w"> </span><span class="n">GivenAServiceDiscoveryClient</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">inotify_instance_facade</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">os</span><span class="o">::</span><span class="n">InotifyInstanceFacade</span><span class="o">&gt;</span><span class="p">(</span><span class="n">inotify_instance_mock_</span><span class="p">);</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">unistd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">os</span><span class="o">::</span><span class="n">internal</span><span class="o">::</span><span class="n">UnistdImpl</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="n">service_discovery_client_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">ServiceDiscoveryClient</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">            </span><span class="n">long_running_threads_container_</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">inotify_instance_facade</span><span class="p">),</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">unistd</span><span class="p">),</span><span class="w"> </span><span class="n">filesystem_</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">ServiceDiscoveryClientFixture</span><span class="o">&amp;</span><span class="w"> </span><span class="n">WithAnOfferedService</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">InstanceIdentifier</span><span class="o">&amp;</span><span class="w"> </span><span class="n">instance_identifier</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="n">service_discovery_client_</span><span class="o">-&gt;</span><span class="n">OfferService</span><span class="p">(</span><span class="n">instance_identifier</span><span class="p">).</span><span class="n">has_value</span><span class="p">());</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">ServiceDiscoveryClientFixture</span><span class="o">&amp;</span><span class="w"> </span><span class="n">WithAnActiveStartFindService</span><span class="p">(</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">InstanceIdentifier</span><span class="o">&amp;</span><span class="w"> </span><span class="n">instance_identifier</span><span class="p">,</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FindServiceHandle</span><span class="w"> </span><span class="n">find_service_handle</span><span class="p">,</span>
<span class="w">        </span><span class="n">FindServiceHandler</span><span class="o">&lt;</span><span class="n">HandleType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">find_service_handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="k">auto</span><span class="p">,</span><span class="w"> </span><span class="k">auto</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="p">{})</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="n">service_discovery_client_</span><span class="o">-&gt;</span><span class="n">StartFindService</span><span class="p">(</span>
<span class="w">            </span><span class="n">find_service_handle</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">find_service_handler</span><span class="p">),</span><span class="w"> </span><span class="n">EnrichedInstanceIdentifier</span><span class="p">{</span><span class="n">instance_identifier</span><span class="p">}));</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">}</span>

<span class="n">TEST_F</span><span class="p">(</span><span class="n">ServiceDiscoveryClientStartFindServiceFixture</span><span class="p">,</span>
<span class="w">       </span><span class="n">CallingStartFindServiceOnOfferedServiceTwiceWithTheSameIdentifierCallsBothHandlers</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="n">MockFunction</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="n">ServiceHandleContainer</span><span class="o">&lt;</span><span class="n">HandleType</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">FindServiceHandle</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="n">find_service_handler_1</span><span class="p">{};</span>

<span class="w">    </span><span class="c1">// Given a ServiceDiscoveryClient with an offered service and a currently active StartFindService</span>
<span class="w">    </span><span class="n">GivenAServiceDiscoveryClient</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">WithAnOfferedService</span><span class="p">(</span><span class="n">kSomeInstanceIdentifier</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">WithAnActiveStartFindService</span><span class="p">(</span>
<span class="w">            </span><span class="n">kSomeInstanceIdentifier</span><span class="p">,</span><span class="w"> </span><span class="n">kHandle</span><span class="p">,</span><span class="w"> </span><span class="n">CreateWrappedMockFindServiceHandler</span><span class="p">(</span><span class="n">find_service_handler_1</span><span class="p">));</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We are still exploring the usage of this pattern so we don’t propose any further guidelines for naming or usage at this
point. But feel free to try it out and add to the guidelines.</p>
</section>
</section>
<section id="miscellaneous">
<h2>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Link to this heading">#</a></h2>
<section id="test-file-length">
<h3>Test File Length<a class="headerlink" href="#test-file-length" title="Link to this heading">#</a></h3>
<p>A test file may contain all tests for a single unit (e.g. a class) as long as there aren’t “too many” tests in that file.
It’s difficult to give an exact number of files or tests which are “too many”. Therefore, it’s up to the developer to
decide whether test readability / maintainability will be improved by splitting up a single test file into multiple.</p>
<p>If a developer decides that there are too many tests in one file, then the split should not be arbitrary but rather be
based on features of the unit under test. It should be easy to find tests and also easy for developers (including other
developers who didn’t write the initial tests) to know where to put new tests.</p>
<p><strong>Example:</strong> A large test file was split into (see the
<a class="reference external" href="https://github.com/eclipse-score/communication/tree/main/score/mw/com/impl/bindings/lola/service_discovery/client">service_discovery/client</a>
folder):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">service_discovery_client_find_service_test.cpp</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">service_discovery_client_offer_service_test.cpp</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">service_discovery_client_sequence_test.cpp</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">service_discovery_client_start_find_service_test.cpp</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">service_discovery_client_stop_find_service_test.cpp</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">service_discovery_client_stop_offer_service_test.cpp</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">service_discovery_client_worker_thread_test.cpp</span></code></p></li>
</ul>
<p>Each test file tests one specific feature of <code class="docutils literal notranslate"><span class="pre">ServiceDiscoveryClient</span></code>. I.e. <code class="docutils literal notranslate"><span class="pre">service_discovery_client_find_service_test.cpp</span></code>
is testing the <code class="docutils literal notranslate"><span class="pre">FindService</span></code> function. <code class="docutils literal notranslate"><span class="pre">service_discovery_client_worker_thread_test.cpp</span></code> is testing the behaviour of the
worker thread which runs throughout the lifetime of <code class="docutils literal notranslate"><span class="pre">ServiceDiscoveryClient</span></code>. <code class="docutils literal notranslate"><span class="pre">service_discovery_client_sequence_test.cpp</span></code>
tests more complex sequences of calling different <code class="docutils literal notranslate"><span class="pre">ServiceDiscoveryClient</span></code> functions (e.g. calling <code class="docutils literal notranslate"><span class="pre">OfferService</span></code> then
<code class="docutils literal notranslate"><span class="pre">StopOfferService</span></code> then <code class="docutils literal notranslate"><span class="pre">StartFindService</span></code> etc.).</p>
</section>
<section id="testing-interfaces-which-take-unique-ptr">
<h3>Testing Interfaces Which Take unique_ptr<a class="headerlink" href="#testing-interfaces-which-take-unique-ptr" title="Link to this heading">#</a></h3>
<p>Some interfaces require that the caller must provide a mockable object to the unit under test by transferring ownership,
e.g. via a <code class="docutils literal notranslate"><span class="pre">unique_ptr</span></code>. In general, we can simply set our expectations on the mock object and then inject it. The
expectations will be evaluated by gtest on destruction of the mock object. However, if this is not possible then another
option is to use a mock facade, which is explained below.</p>
<section id="mock-facade">
<h4>Mock Facade<a class="headerlink" href="#mock-facade" title="Link to this heading">#</a></h4>
<p>A mock facade is a class which inherits from the interface of the mockable object so can be passed to the unit under test
as a <code class="docutils literal notranslate"><span class="pre">unique_ptr</span></code>. The facade stores a reference to the actual mocked object which is owned by the test and forwards all
calls to the mocked object. This allows the ownership of the mock to be managed by the test while the ownership of the
facade is managed by the unit under test (which can destroy the facade at any time while not affecting the mocked object).
An example of a facade class can be found in
<a class="reference external" href="https://github.com/eclipse-score/baselibs/blob/main/score/os/utils/inotify/inotify_instance_facade.h">inotify_instance_facade.h</a>.</p>
</section>
<section id="specify-expectations-on-mock-before-handing-over">
<h4>Specify Expectations on Mock Before Handing Over<a class="headerlink" href="#specify-expectations-on-mock-before-handing-over" title="Link to this heading">#</a></h4>
<p>GTest does not require mocks to stay alive until a test finishes. In fact, it evaluates mocks on destruction (i.e. to check
whether all expectations were met). Therefore, you can simply specify all expectations on a mock before passing it to the
unit under test as a <code class="docutils literal notranslate"><span class="pre">unique_ptr</span></code>.</p>
</section>
</section>
<section id="bazel-targets">
<h3>Bazel Targets<a class="headerlink" href="#bazel-targets" title="Link to this heading">#</a></h3>
<p>Generally, we should have one bazel test target per production code test target. We should avoid having a single test target
per directory. This leads to longer build times when wanting to run a single test, complicates the dependency tree and also
requires us to mark multiple tests as flaky, long running etc. even if only one test in the suite is the culprit.</p>
<p>We should try to use the following macros in the following order (i.e. if the first cannot be used, then try the next one):
<code class="docutils literal notranslate"><span class="pre">cc_gtest_unit_test</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">cc_unit_test</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">cc_test</span></code>.</p>
<p>We should also have one <code class="docutils literal notranslate"><span class="pre">cc_unit_test_suites_for_host_and_qnx</span></code> per directory which accumulates all of the test targets in
the directory and the test suites from child directories.</p>
</section>
<section id="death-tests">
<span id="id2"></span><h3>Death Tests<a class="headerlink" href="#death-tests" title="Link to this heading">#</a></h3>
<p>Tests containing <code class="docutils literal notranslate"><span class="pre">EXPECT_DEATH</span></code> should always have <code class="docutils literal notranslate"><span class="pre">DeathTest</span></code> at the end of the <code class="docutils literal notranslate"><span class="pre">TestSuiteName</span></code>.
See <a class="reference external" href="https://github.com/google/googletest/blob/main/docs/advanced.md#death-tests-and-threads">Death Tests and Threads</a>
for more information.</p>
</section>
</section>
<section id="examples-of-good-tests">
<h2>Examples of Good Tests<a class="headerlink" href="#examples-of-good-tests" title="Link to this heading">#</a></h2>
<p><em>(This section is a placeholder for future examples.)</em></p>
</section>
<section id="future-work">
<h2>Future Work<a class="headerlink" href="#future-work" title="Link to this heading">#</a></h2>
<p>This document is a work in progress. Feel free to add to existing sections, add new sections or add points here for
discussion / addition in the future.</p>
<ul class="simple">
<li><p>Add better guidelines for naming tests and fixtures</p></li>
<li><p>Add better guidelines for test fixture design (including builder pattern)</p></li>
<li><p>Add examples of good tests</p></li>
<li><p>Add guidelines for death tests</p></li>
<li><p>Add guidelines for typed tests and parameterised tests (figure out if we can name each sub-test)</p></li>
<li><p>Do we always want given, when, then comments? What if the test is simple and it’s completely clear in the code what’s
being done? What if we use the builder pattern and have a setup solely consisting of <code class="docutils literal notranslate"><span class="pre">GivenSomeObject()</span></code>. Do we need
a comment above saying <code class="docutils literal notranslate"><span class="pre">//</span> <span class="pre">Given</span> <span class="pre">some</span> <span class="pre">object</span></code>?</p></li>
<li><p>Add examples to Expecting section</p></li>
</ul>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="python/coding_guidelines.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Writing Python Code</p>
      </div>
    </a>
    <a class="right-next"
       href="../ci/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">CI</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-naming">Test Naming</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-content">Test Content</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#given-when-expecting-then">Given, When, (Expecting / Then)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#given">Given</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#expecting">Expecting</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#when">When</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#then">Then</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-should-a-test-contain">What Should a Test Contain</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#expect-call-vs-on-call">EXPECT_CALL vs ON_CALL</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-constants">Test Constants</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-fixtures">Test Fixtures</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-fixture-builder-pattern">Test Fixture Builder Pattern</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#miscellaneous">Miscellaneous</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-file-length">Test File Length</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-interfaces-which-take-unique-ptr">Testing Interfaces Which Take unique_ptr</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mock-facade">Mock Facade</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#specify-expectations-on-mock-before-handing-over">Specify Expectations on Mock Before Handing Over</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bazel-targets">Bazel Targets</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#death-tests">Death Tests</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examples-of-good-tests">Examples of Good Tests</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#future-work">Future Work</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/eclipse-score/score/edit/main/docs/contribute/development/testing_guidelines.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>